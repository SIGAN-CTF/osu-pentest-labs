import re
from typing import Tuple
from utils import run_command


def run_machine(path: str) -> Tuple[int, str]:
    cmd = ["vagrant", "up"]
    code, stdout, stderr = run_command(cmd, cwd=path)
    return code, stdout, stderr


def destroy_machine(path: str):
    cmd = ["vagrant", "destroy", "-f"]
    code, stdout, stderr = run_command(cmd, cwd=path)
    return code, stdout, stderr


def restart_machine(path: str):
    cmd = ["vagrant", "reload"]
    code, stdout, stderr = run_command(cmd, cwd=path)
    return code, stdout, stderr


def get_vm_os(path: str):
    cmd = ['vagrant', 'ssh', '-c', 'uname']
    code, stdout, stderr = run_command(cmd, cwd=path)
    if 'Linux' in stdout:
        return 'linux'
    else:
        return 'windows'


def get_vm_ip(path: str):
    cmd = ['vagrant', 'ssh', '-c', 'ip a || ipconfig']
    code, stdout, stderr = run_command(cmd, cwd=path)
    match = re.search(r'(192\.\d+\.\d+\.\d+)/\d+', stdout)
    if match:
        ip_address = match.group(1)
        return ip_address
    else:
        return None


if __name__ == "__main__":
    ip = get_vm_ip("labs/01-php-lfi-lab")
    print(ip)
